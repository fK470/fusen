# Fusen アプリケーション テスト仕様書

## 1. はじめに

### 1.1. 本書の目的

本書は、ブックマーク管理アプリケーション「Fusen」（以下、本アプリ）の品質を検証するためのテスト仕様を定義する。

### 1.2. 対象範囲

本テスト仕様書は、本アプリのMVP（Minimum Viable Product）で定義された以下の機能およびAPIを対象とする。

* ブックマーク管理機能（登録、一覧表示、更新、削除）
* タグ登録・関連付け機能（ブックマーク登録・更新時）
* 関連するAPIエンドポイント

### 1.3. テストの種類とツール

本テストでは、以下の種類のテストを実施し、それぞれ指定されたツールを使用する。

* **APIテスト:** バックエンドAPIの動作検証。
  * ツール: `echoapi` (または同等のAPIテストクライアントを想定。ここではリクエストと期待されるレスポンスを定義)

* **E2E（End-to-End）テスト:** ユーザーインターフェースを通じたシステム全体の動作検証。
  * ツール: `Selenium`

## 2. テスト環境

テストは、以下の環境を想定して実施する。

* **バックエンド:** ローカル開発環境またはステージング環境のAPIサーバー
* **フロントエンド:** ローカル開発環境またはステージング環境で動作するWebブラウザ
  * 対象ブラウザ: Google Chrome (最新版)
  * レスポンシブ対応確認のため、モバイルエミュレーションも実施
* **データベース:** MySQL (テスト用データを用意)

## 3. APIテスト (echoapi)

APIテストは、各エンドポイントに対して、正常系および想定される異常系のリクエストを送信し、レスポンスが仕様通りであることを確認する。

### 3.1. ブックマーク (`/bookmarks`)

#### 3.1.1. ブックマーク作成 (POST /api/v1/bookmarks)

| テストケースID | 概要   | 前提条件 | 手順 (リクエスト)   | 期待結果 (レスポンス)  | 備考   |
| :--- | :--- | :--- | :-- | :--- | :--- |
| API_BM_C_001   | 正常なデータでブックマークを登録できる   | なし   | Method: POST<br>Body:<br>```json{  "url": "https://example.com/test1",  "title": "Test Bookmark 1",  "description": "Desc 1",  "tags": ["tagA", "tagB"]}``` | Status: 201 Created<br>Body: `id`, `url`, `title`, `description`, `tags`, `createdAt`, `updatedAt` を含むJSONオブジェクト。入力値が反映されていること。`createdAt`, `updatedAt` は適切な日時であること。DBにデータが保存される。 | 正常系   |
| API_BM_C_002   | URLが必須項目であることを確認する  | なし   | Method: POST<br>Body:<br>```json{  "title": "No URL Bookmark"}```  | Status: 400 Bad Request<br>Body: `errorCode`, `message` を含むエラーレスポンス (例: `INVALID_URL` または汎用的な `BAD_REQUEST`)   | 異常系   |
| API_BM_C_003   | URLの形式が不正な場合にエラーとなることを確認する | なし   | Method: POST<br>Body:<br>```json{  "url": "invalid-url"}```  | Status: 400 Bad Request<br>Body: `errorCode: "INVALID_URL"`, `message` を含むエラーレスポンス  | 異常系   |
| API_BM_C_004   | タイトルが任意であることを確認する   | なし   | Method: POST<br>Body:<br>```json{  "url": "https://example.com/notitle",  "description": "No title test"}```  | Status: 201 Created<br>Body: `title`がnullまたは自動取得された値（スコープ外の場合はnull）で登録される。  | 正常系   |
| API_BM_C_005   | 既に登録済みのURLの場合にエラーとなることを確認する | 事前に `https://example.com` を登録 | Method: POST<br>Body:<br>```json{  "url": "https://example.com"}```  | Status: 409 Conflict<br>Body: `errorCode: "DUPLICATE_URL"`, `message` を含むエラーレスポンス  | 異常系   |

#### 3.1.2. ブックマーク一覧取得 (GET /api/v1/bookmarks)

| テストケースID | 概要   | 前提条件   | 手順 (リクエスト)   | 期待結果 (レスポンス)  | 備考   |
| :--- | :--- | :--- | :-- | :--- | :--- |
| API_BM_R_001   | 登録済みのブックマーク一覧を取得できる   | ブックマークが複数件登録されていること | Method: GET   | Status: 200 OK<br>Body: ブックマークオブジェクトの配列。各オブジェクトは `id`, `url`, `title`, `description`, `tags`, `createdAt`, `updatedAt` を含む。デフォルトは登録日時の降順。 | 正常系 |
| API_BM_R_002   | `limit` パラメータで取得件数を指定できる   | ブックマークが10件以上登録されていること | Method: GET<br>Query: `limit=5`   | Status: 200 OK<br>Body: ブックマークオブジェクトの配列（最大5件）。  | 正常系 |
| API_BM_R_003   | `offset` パラメータで開始位置を指定できる | ブックマークが10件以上登録されていること | Method: GET<br>Query: `limit=5&offset=5`  | Status: 200 OK<br>Body: 6件目から5件のブックマークオブジェクトの配列。  | 正常系 |
| API_BM_R_004   | ブックマークが0件の場合、空の配列が返る  | ブックマークが登録されていないこと   | Method: GET   | Status: 200 OK<br>Body: 空の配列 `[]`  | 正常系 |

#### 3.1.3. 特定ブックマーク取得 (GET /api/v1/bookmarks/{id})

| テストケースID | 概要   | 前提条件   | 手順 (リクエスト)  | 期待結果 (レスポンス)   | 備考   |
| :--- | :--- | :--- | :--- | :-- | :--- |
| API_BM_R_ID_001| 指定したIDのブックマークを取得できる   | ID `1` のブックマークが存在する  | Method: GET<br>Path: `/1` | Status: 200 OK<br>Body: ID `1` のブックマークオブジェクト。  | 正常系 |
| API_BM_R_ID_002| 存在しないIDを指定した場合エラーとなる   | ID `999` のブックマークが存在しない  | Method: GET<br>Path: `/999`| Status: 404 Not Found<br>Body: `errorCode: "BOOKMARK_NOT_FOUND"`, `message` を含むエラーレスポンス  | 異常系 |

#### 3.1.4. 特定ブックマーク更新 (PUT /api/v1/bookmarks/{id})

| テストケースID | 概要   | 前提条件   | 手順 (リクエスト)   | 期待結果 (レスポンス)  | 備考   |
| :--- | :--- | :--- | :-- | :--- | :--- |
| API_BM_U_001   | 指定したIDのブックマーク情報を更新できる   | ID `1` のブックマークが存在する  | Method: PUT<br>Path: `/1`<br>Body:<br>```json{  "url": "https://example.com/updated",  "title": "Updated Title",  "description": "Updated Desc",  "tags": ["updated"]}``` | Status: 200 OK<br>Body: 更新後のブックマークオブジェクト。`updatedAt` が更新されていること。DBのデータが更新される。   | 正常系 |
| API_BM_U_002   | 存在しないIDを指定した場合エラーとなる   | ID `999` のブックマークが存在しない  | Method: PUT<br>Path: `/999`<br>Body: (API_BM_U_001と同様)   | Status: 404 Not Found<br>Body: `errorCode: "BOOKMARK_NOT_FOUND"`, `message` を含むエラーレスポンス  | 異常系 |
| API_BM_U_003   | URLの形式が不正な場合にエラーとなることを確認する | ID `1` のブックマークが存在する  | Method: PUT<br>Path: `/1`<br>Body:<br>```json{  "url": "invalid-url-update"}```   | Status: 400 Bad Request<br>Body: `errorCode: "INVALID_URL"`, `message` を含むエラーレスポンス  | 異常系 |

#### 3.1.5. 特定ブックマーク削除 (DELETE /api/v1/bookmarks/{id})

| テストケースID | 概要   | 前提条件   | 手順 (リクエスト)   | 期待結果 (レスポンス)   | 備考   |
| :--- | :--- | :--- | :-- | :-- | :--- |
| API_BM_D_001   | 指定したIDのブックマークを削除できる   | ID `1` のブックマークが存在する  | Method: DELETE<br>Path: `/1` | Status: 204 No Content<br>DBからデータが削除される。  | 正常系 |
| API_BM_D_002   | 存在しないIDを指定した場合エラーとなる   | ID `999` のブックマークが存在しない  | Method: DELETE<br>Path: `/999`| Status: 404 Not Found<br>Body: `errorCode: "BOOKMARK_NOT_FOUND"`, `message` を含むエラーレスポンス  | 異常系 |

## 4. E2Eテスト (Selenium)

ユーザーストーリーおよび画面仕様に基づき、ユーザー操作によるシナリオテストを実施する。

### 4.1. ブックマーク一覧画面 (BM001)

| テストシナリオID | 概要   | 前提条件   | 手順   | 期待結果  | 備考   |
| :--- | :--- | :--- | :--- | :-- | :--- |
| E2E_BM001_001  | ブックマーク一覧が正しく表示される (ユーザーストーリー 2.1, 2.2)   | 複数のブックマークが登録済み   | 1. アプリケーションにアクセスする。<br>2. ブックマーク一覧画面(BM001)が表示されることを確認する。  | 登録されているブックマークが一覧に表示される。<br>各ブックマークにはタイトル、説明メモの先頭が表示される。<br>デフォルトで登録日時が新しい順に表示される。  | PC/Mobile  |
| E2E_BM001_002  | レイジーロードが機能する (ユーザーストーリー 2.3)  | 画面に収まりきらない多数のブックマークが登録済み | 1. ブックマーク一覧画面(BM001)を表示する。<br>2. 画面を下にスクロールする。   | スクロールに応じて、次のブックマークが読み込まれ表示される。  | PC/Mobile  |
| E2E_BM001_003  | 「追加ボタン」からブックマーク登録画面へ遷移する (ユーザーストーリー 1.4)  | ブックマーク一覧画面(BM001)が表示されている  | 1. 「追加ボタン」をクリックする。   | ブックマーク登録画面(BM002)が表示される (PC:モーダル, Mobile:新規画面)。  | PC:モーダル<br>Mobile:新規画面 |

### 4.2. ブックマーク登録画面 (BM002)

| テストシナリオID | 概要   | 前提条件   | 手順   | 期待結果   | 備考   |
| :--- | :--- | :--- | :--- | :--- | :--- |
| E2E_BM002_001  | 新しいブックマークを正常に登録できる (ユーザーストーリー 1.1)  | ブックマーク一覧画面から登録画面に遷移済み   | 1. URLに "https://selenium.dev" を入力。<br>2. タイトルに "Selenium Official" を入力。<br>3. 説明メモに "E2E test tool" を入力。<br>4. タグに "test, selenium" を入力。<br>5. 「登録」ボタンをクリック。  | ブックマーク一覧画面(BM001)に戻り、登録したブックマークが一覧の先頭に表示される。  | PC/Mobile  |
| E2E_BM002_002  | タイトル未入力時に自動でタイトルが設定される (ユーザーストーリー 1.2) | ブックマーク一覧画面から登録画面に遷移済み   | 1. URLに "https://www.google.com" を入力。<br>2. タイトルは未入力。<br>3. 「登録」ボタンをクリック。  | ブックマーク一覧画面(BM001)に戻り、登録したブックマークが表示される。タイトルにはURLから抽出された文字列（または空文字、API仕様に依存）が表示される。  | PC/Mobile  |
| E2E_BM002_003  | URLが不正な形式の場合にエラーメッセージが表示される (ユーザーストーリー 1.3)   | ブックマーク一覧画面から登録画面に遷移済み   | 1. URLに "invalid-url-format" を入力。<br>2. 「登録」ボタンをクリック。   | 登録画面にエラーメッセージ（例: "有効なURLを入力してください"）が表示され、一覧画面に遷移しない。  | PC/Mobile  |
| E2E_BM002_004  | 「キャンセル」ボタンで一覧画面に戻る   | ブックマーク一覧画面から登録画面に遷移済み   | 1. 「キャンセル」ボタン（または閉じるアイコン）をクリック。  | ブックマーク一覧画面(BM001)に戻る。入力内容は保存されない。  | PC/Mobile  |

### 4.3. ブックマーク編集画面 (BM003)

| テストシナリオID | 概要   | 前提条件   | 手順   | 期待結果   | 備考   |
| :--- | :--- | :--- | :--- | :--- | :--- |
| E2E_BM003_001  | 既存のブックマーク情報を正常に更新できる (ユーザーストーリー 3.1, 3.2)   | ブックマークが1件以上登録済み。<br>一覧画面から編集対象のブックマークを選択し編集画面(BM003)に遷移済み。 | 1. タイトルを "Updated Selenium Title" に変更。<br>2. 説明メモを "Updated E2E test tool" に変更。<br>3. タグに "updated" を追加。<br>4. 「更新」ボタンをクリック。   | ブックマーク一覧画面(BM001)に戻り、更新したブックマークの情報が正しく反映されている。   | PC/Mobile  |
| E2E_BM003_002  | URLを不正な形式に更新しようとするとエラーが表示される  | (E2E_BM003_001と同様)  | 1. URLを "invalid-updated-url" に変更。<br>2. 「更新」ボタンをクリック。  | 編集画面にエラーメッセージが表示され、一覧画面に遷移しない。  | PC/Mobile  |
| E2E_BM003_003  | 「キャンセル」ボタンで一覧画面に戻る（変更は保存されない）   | (E2E_BM003_001と同様)  | 1. タイトルを一時的に変更。<br>2. 「キャンセル」ボタン（または閉じるアイコン）をクリック。  | ブックマーク一覧画面(BM001)に戻る。ブックマークの情報は変更されていない。  | PC/Mobile  |

### 4.4. ブックマーク削除機能 (BM001上の操作とBM004)

| テストシナリオID | 概要   | 前提条件   | 手順   | 期待結果   | 備考  |
| :--- | :--- | :--- | :--- | :--- | :-- |
| E2E_BM004_001  | ブックマークを正常に削除できる (ユーザーストーリー 4.1, 4.2)   | ブックマークが1件以上登録済み  | 1. ブックマーク一覧画面(BM001)で、削除対象のブックマークの「メニューボタン」をクリック。<br>2. 表示された「削除ボタン」をクリック。<br>3. 削除確認ダイアログ(BM004)が表示されることを確認。<br>4. ダイアログの「削除」ボタンをクリック。 | ブックマーク一覧画面(BM001)に戻り、対象のブックマークが一覧から削除されている。  | PC/Mobile |
| E2E_BM004_002  | 削除確認ダイアログで「キャンセル」すると削除されない   | ブックマークが1件以上登録済み  | 1. ブックマーク一覧画面(BM001)で、削除対象のブックマークの「メニューボタン」をクリック。<br>2. 表示された「削除ボタン」をクリック。<br>3. 削除確認ダイアログ(BM004)が表示されることを確認。<br>4. ダイアログの「キャンセル」ボタンをクリック。 | ブックマーク一覧画面(BM001)に戻り、対象のブックマークが一覧に残っている。  | PC/Mobile |

## 5. 非機能要件テスト

### 5.1. 性能

* **観点:** 主要なユーザー操作（一覧表示、登録、更新、削除）に対するシステムの応答時間が、原則として1秒以内であること。
* **テスト方法:** ブラウザの開発者ツールや手動計測により、各操作の体感的なレスポンスタイムを確認する。

### 5.2. セキュリティ

* **観点:** Webアプリケーションとしての基本的なセキュリティ対策が講じられていること。
* **テスト方法 (手動確認):**
  * ブックマーク登録・更新時の入力フィールド（URL、タイトル、説明、タグ）に簡単なHTMLタグ（例: `<h1>test</h1>`, `<script>alert('XSS')</script>`）を入力し、XSS脆弱性がないか確認する（タグがエスケープされて表示される、またはスクリプトが実行されない）。
  * CSRF対策がSpring Securityのデフォルト設定で有効になっていることを確認する（開発者によるコードレビューまたは設定確認）。

### 5.3. レスポンシブデザイン

* **観点:** モバイル端末、タブレット、デスクトップPCなど、様々な画面サイズで快適に利用できること。
* **テスト方法:** Google Chromeの開発者ツールを使用し、異なるデバイスの画面サイズで各画面（BM001, BM002, BM003, BM004）のレイアウトが崩れず、操作可能であることを確認する。

## 6. テストデータ

テストの実施には、以下のようなテストデータを使用する。

* **正常系データ:**
  * 有効なURL (http/httpsから始まる)
  * 様々な長さのタイトル、説明メモ
  * 複数のタグ、タグなし
* **異常系データ:**
  * 無効な形式のURL
  * 非常に長い文字列
  * 特殊文字を含む文字列
  * 境界値データ (例: 最大文字数制限がある場合)

## 7. 不具合報告

テスト中に発見された不具合は、以下の情報を含めて報告する。

* 不具合ID
* 発見日
* 報告者
* テストケースID (該当する場合)
* 不具合の概要
* 再現手順
* 期待される結果
* 実際の結果
* 深刻度 (例: 高、中、低)
* 優先度 (例: 高、中、低)
* スクリーンショットやログ (可能な場合)
